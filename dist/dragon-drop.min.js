/*! dragon-drop - v1.0.6 - 2015-02-09
* https://github.com/jimschubert/angular-dragon-drop
* Copyright (c) 2015 Brian Ford; License: MIT */

!function(){"use strict";var a,b=/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*(?:\|\s+([\s\S]+?))?\s*$/,c={FIRST:"FIRST",PREV:"PREV",NEXT:"NEXT",LAST:"LAST"},d=function(){return console&&"function"==typeof console.debug&&-1!==(window.DEBUG||"").indexOf("dragon-drop")?function(){console.debug.call(console,a.format.apply(null,arguments))}:function(){}}();angular.module("dragon-drop",[]).directive("dragon",["$document","$compile","$rootScope","$http","$templateCache","$window",function(e,f,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v=!1,w=!1,x=!0,y=angular.element(e[0].body),z={x:0,y:0};e[0].addEventListener("mousemove",function(a){z.x=a.clientX||a.pageX,z.y=a.clientY||a.pageY},!1);var A=function(a){return function(b){return angular.isDefined(angular.element(b).attr(a))}},B=function(a){var b,c=a.parent(),d=c.length;for(b=0;d>b;b++){if(c[b].hasAttribute("data-dragon-fixed"))return!0;if(c[b].hasAttribute("data-dragon"))return!1}return!1},C=function(b){var e,f,g;if(o)if(f=K(T(q,z.x,z.y)[0]))if(f=angular.element(f),f===m||F(f))m=f;else{var h=o;if(e=L(f[0]),g=D(f,S(e[0])),angular.element(h).remove(),E(),d("Moving %s",g),I(f)){var i=O(f);f[0].insertBefore(o,i)}else g===c.FIRST?(u=0,e[0].insertBefore(o,e[0].firstChild)):g===c.PREV?(e[0].insertBefore(o,f[0]),u=a.getIndex(e[0].children,o)):g===c.NEXT?(e[0].insertBefore(o,f[0].nextSibling),u=a.getIndex(e[0].children,o)):(u=e[0].children.length-1,e[0].appendChild(o));m=angular.element(o)}else u=null;q.css({left:b.clientX-r+"px",top:b.clientY-s+"px"})},D=function(a,b){var d,e,f=S(o),g=S(a[0]),h=S(q[0]),i=a[0].offsetHeight/2,j=a[0].offsetWidth/2;return g.top===b.top&&g.bottom===b.bottom&&(e=!0),d=e?h.top<g.top+i||h.left<g.left+j?c.FIRST:c.LAST:f.top>g.top?h.top>g.top+i?c.PREV:c.NEXT:h.right>g.right-j?c.NEXT:h.left<g.left+j?c.PREV:h.top<g.top+i?c.NEXT:c.PREV},E=function(){var a=angular.element(p);return a.attr("data-dragon-placeholder",!0),o=a[0],a},F=A("data-dragon-placeholder"),G=A("data-dragon-position"),H=A("data-dragon-container"),I=A("data-dragon-base"),J=A("data-dragon"),K=function(a){var b,c=a;do{var d=angular.element(c);F(d)||H(d)||G(d)||J(d)?b=c:c=c?c.parentElement:null}while(!b&&c);return angular.isDefined(b)?b:null},L=function(a){for(var b=a;b;){var c=angular.element(b);if(J(c))return c;b=b.parentElement}return null},M=function(a,b){if(angular.isArray(a))return a.splice(b,1);var c=a[b];return delete a[b],c},N=function(a,b,c,d){if(angular.isArray(a)){var e;e=0===d||d?d:a.length,a.splice(e,0,b)}else a[c]=b},O=function(a){for(var b=a.find("*"),c=0;c<b.length;c++)if(b[c].hasAttribute("data-dragon-container"))return angular.element(b[c]);return null},P=function(){y.css({"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"})},Q=function(){y.css({"-moz-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":""})},R=function(){q&&(g.$broadcast("drag-end"),e.unbind("mousemove",C),q.scope().$destroy(),q.remove(),q=null,Q())},S=function(a){var b=a.getBoundingClientRect(),c=e[0].documentElement,d=b.left+c.scrollLeft,f=b.top+c.scrollTop;return{left:d,top:f,bottom:b.bottom,height:b.height,right:b.right,width:b.width}},T=function(a,b,c){var d,f=a.css("display");return a.css("display","none"),d=angular.element(e[0].elementFromPoint(b,c)),a.css("display",f),d},U=function(a,b){var c,d=[];if(a[0]){var e=a[0].getBoundingClientRect().top,f=a[0].getBoundingClientRect().bottom;d.push(e);var g,h,i,j;for(g=0,i=a[0].children.length;i>g;g++){var k=0,l=Number.POSITIVE_INFINITY;for(h=0,j=a[0].children[g].getClientRects().length;j>h;h++)l>a[0].children[g].getClientRects()[h].top&&(l=a[0].children[g].getClientRects()[h].top),k+=a[0].children[g].getClientRects()[h].height;void 0!==a[0].children[g].attributes["data-dragon-position"]&&d.push(l+k/2)}for(d.push(f),g=0;g<d.length;)d[g]<=b.clientY&&(c=g),g++;return c}};return e.bind("mouseup",function(a){x=!0;var c;if(k){for(var d=T(q,a.clientX,a.clientY),e=function(){return(d.attr("data-dragon")||angular.isDefined(d.attr("data-dragon-trash")))&&(!d.attr("data-dragon-accepts")||d.scope().$eval(d.attr("data-dragon-accepts"))(k))};d.length>0&&!e();)d=d.parent();var f=d.attr("data-dragon-sortable");if(void 0!==f?c=0===u||u?u:U(d,a):u=null,o&&(angular.element(o).remove(),o=null),d.length>0){{var h=angular.isDefined(d.attr("data-dragon"));angular.isDefined(d.attr("data-dragon-trash"))}if(h){var i=d.attr("data-dragon"),j=d.attr("data-dragon-on-drop"),m=d.scope(),p=i.match(b),r=m.$eval(p[2]),s=m.$eval(j);m.$apply(function(){N(r,k,l,c),s&&angular.isFunction(s)&&s(k,l)})}}else v||w||g.$apply(function(){N(n,k,l,c)});k=n=null,R()}}),{restrict:"A",compile:function(a,c){var d=c.dragon,m=d.match(b);if(!m)throw new Error('Expected dragon in form of "_item_ in _collection_ [as _alias_] [track by _track_] [| _filter_]" but got "'+d+'"."');var u=m[1],z=m[2];m=u.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);var A=m[3]||m[1],D=m[2];if(void 0!==a.attr("data-dragon-base")&&(a=O(a),!a))throw new Error("Expected data-dragon-base to be used with a companion data-dragon-conatiner");var F=a.html();try{if(F=angular.element(F.trim()),0===F.length)throw new Error("")}catch(G){F=angular.element("<span>"+F+"</span>")}var H=F.clone();H.attr("ng-repeat",d),void 0!==a.attr("data-dragon-sortable")&&H.attr("data-dragon-position","{{$index}}"),a.html(""),a.append(H);var I=void 0!==a.attr("data-dragon-duplicate"),J=void 0!==a.attr("data-dragon-eliminate"),K=a.attr("data-dragon-placeholder-template");return function(a,b,c){var d=a.$eval(c.dragonAccepts),m=angular.isDefined(K)?i.get(K):null;if(void 0!==d&&"function"!=typeof d)throw new Error("Expected dragonAccepts to be a function.");var u=function(){g.$broadcast("drag-start"),a.$apply(function(){q=F.clone(),q[0].style.cssText=j.getComputedStyle(F[0],null).cssText,q.css("position","fixed"),q.css("margin","0px"),q.css("z-index","99999");var b=a.$new();b[A]=k,D&&(b[D]=l),f(q)(b),y.append(q),e.bind("mousemove",C),P()})};b.bind("mousedown",function(a){if(!([1,2].indexOf(a.button)>-1)){var b=e[0].elementFromPoint(a.clientX,a.clientY).tagName;"SELECT"!==b&&"INPUT"!==b&&"BUTTON"!==b&&(x=!1,t=!!B(angular.element(a.target)),angular.isDefined(K)?angular.isDefined(m)?p=m:h({method:"GET",url:K,cache:!0}).then(function(a){p=m=a&&a.data}):p=null,a.preventDefault())}}),b.bind("mousemove",function(c){if(!(k||x||B(angular.element(c.target))||t)){for(var d=angular.element(c.target),e=d.scope();void 0===e[A];)if(e=e.$parent,!e)return;if(k=e[A],l=e[D],k){var f=S(c.target);if(n=a.$eval(z),v=I,w=J,r=c.clientX-f.left,s=c.clientY-f.top,I)k=angular.copy(k);else{var g,h=b.children();if(p)for(var i=0;!g&&i<h.length;i++){var j=h[i];angular.element(j).scope()[D||A]===k&&i>0&&(g=h[i-1])}a.$apply(function(){M(n,l||n.indexOf(k)),p?(E(),angular.isUndefined(g)?b[0].insertBefore(o,b[0].firstChild):angular.element(g).after(o)):o=null})}u()}}})}}}}]),a=function(){function a(b,c){if("undefined"==typeof c&&(c=""),c.length>50)return"[MAX ITERATIONS]";var d=[];for(var e in b){var f=typeof b[e];d.push(c+'"'+e+'" ('+f+") => "+("object"==f?"object:"+a(b[e],c+"  "):b[e]+""))}return d.join(c+"\n")}function b(a,b){return c.call(a).indexOf(b)}var c=Array.prototype.slice,d=/%[sdj%]/g,e=function(b){if("string"!=typeof b){for(var c=[],e=0;e<arguments.length;e++)c.push(a(arguments[e]));return c.join(" ")}for(var e=1,f=arguments,g=f.length,h=String(b).replace(d,function(a){if(e>=g)return a;switch(a){case"%s":return String(f[e++]);case"%d":return Number(f[e++]);case"%j":return JSON.stringify(f[e++]);case"%%":return"%";default:return a}}),i=f[e];g>e;i=f[++e])h+=null===i||"object"!=typeof i?" "+i:" "+a(i);return h};return{format:e,inspect:a,getIndex:b}}()}();
//# sourceMappingURL=dragon-drop.min.js.map