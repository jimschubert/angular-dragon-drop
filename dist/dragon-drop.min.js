/*! dragon-drop - v1.0.4 - 2015-02-03
* https://github.com/jimschubert/angular-dragon-drop
* Copyright (c) 2015 Brian Ford; License: MIT */

!function(){"use strict";var a,b=/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*(?:\|\s+([\s\S]+?))?\s*$/,c={FIRST:"FIRST",PREV:"PREV",NEXT:"NEXT",LAST:"LAST"},d=function(){return console&&"function"==typeof console.debug&&-1!==(window.DEBUG||"").indexOf("dragon-drop")?function(){console.debug.call(console,a.format.apply(null,arguments))}:function(){}}();angular.module("dragon-drop",[]).directive("dragon",["$document","$compile","$rootScope","$http","$templateCache","$window",function(a,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t=!1,u=!1,v=!0,w=angular.element(a[0].body),x={x:0,y:0};a[0].addEventListener("mousemove",function(a){x.x=a.clientX||a.pageX,x.y=a.clientY||a.pageY},!1);var y=function(a){return function(b){return angular.isDefined(angular.element(b).attr(a))}},z=function(a){var b,c=a.parent(),d=c.length;for(b=0;d>b;b++){if(c[b].hasAttribute("data-dragon-fixed"))return!0;if(c[b].hasAttribute("data-dragon"))return!1}return!1},A=function(a){var b,e,f;if(n&&(e=I(R(p,x.x,x.y)[0])))if(e=angular.element(e),e===l||D(e))l=e;else{var g=n;if(b=J(e[0]),f=B(e,Q(b[0])),angular.element(g).remove(),C(),d("Moving %s",f),G(e)){var h=M(e);e[0].insertBefore(n,h)}else f===c.FIRST?b[0].insertBefore(n,b[0].firstChild):f===c.PREV?b[0].insertBefore(n,e[0]):f===c.NEXT?b[0].insertBefore(n,e[0].nextSibling):b[0].appendChild(n);l=angular.element(n)}p.css("left",a.clientX-q+"px"),p.css("top",a.clientY-r+"px")},B=function(a,b){var d,e,f=Q(n),g=Q(a[0]),h=Q(p[0]),i=angular.element(a)[0].offsetHeight/2;return g.top===b.top&&g.bottom===b.bottom&&(e=!0),d=!0!==e&&f.top>g.top?h.top>g.top+i?c.PREV:c.NEXT:h.top<g.top+i?e?c.FIRST:c.NEXT:e?c.LAST:c.PREV},C=function(){var a=angular.element(o);return a.attr("data-dragon-placeholder",!0),n=a[0],a},D=y("data-dragon-placeholder"),E=y("data-dragon-position"),F=y("data-dragon-container"),G=y("data-dragon-base"),H=y("data-dragon"),I=function(a){var b,c=a;do{var d=angular.element(c);D(d)||F(d)||E(d)||H(d)?b=c:c=c?c.parentElement:null}while(!b&&c);return angular.isDefined(b)?b:null},J=function(a){for(var b=a;b;){var c=angular.element(b);if(H(c))return c;b=b.parentElement}return null},K=function(a,b){if(angular.isArray(a))return a.splice(b,1);var c=a[b];return delete a[b],c},L=function(a,b,c,d){if(angular.isArray(a)){var e;e=0===d||d?d:a.length,a.splice(e,0,b)}else a[c]=b},M=function(a){for(var b=a.find("*"),c=0;c<b.length;c++)if(b[c].hasAttribute("data-dragon-container"))return angular.element(b[c]);return null},N=function(){w.css({"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"})},O=function(){w.css({"-moz-user-select":"","-khtml-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":""})},P=function(){p&&(f.$broadcast("drag-end"),a.unbind("mousemove",A),p.scope().$destroy(),p.remove(),p=null,O())},Q=function(b){var c=b.getBoundingClientRect(),d=a[0].documentElement,e=c.left+d.scrollLeft,f=c.top+d.scrollTop;return{left:e,top:f,bottom:c.bottom,height:c.height}},R=function(b,c,d){var e,f=b.css("display");return b.css("display","none"),e=angular.element(a[0].elementFromPoint(c,d)),b.css("display",f),e},S=function(a,b){var c,d=[];if(a[0]){var e=a[0].getBoundingClientRect().top,f=a[0].getBoundingClientRect().bottom;d.push(e);var g,h,i,j;for(g=0,i=a[0].children.length;i>g;g++){var k=0,l=Number.POSITIVE_INFINITY;for(h=0,j=a[0].children[g].getClientRects().length;j>h;h++)l>a[0].children[g].getClientRects()[h].top&&(l=a[0].children[g].getClientRects()[h].top),k+=a[0].children[g].getClientRects()[h].height;void 0!==a[0].children[g].attributes["data-dragon-position"]&&d.push(l+k/2)}for(d.push(f),g=0;g<d.length;)d[g]<=b.clientY&&(c=g),g++;return c}};return a.bind("mouseup",function(a){v=!0;var c;if(j){for(var d=R(p,a.clientX,a.clientY),e=function(){return(d.attr("data-dragon")||angular.isDefined(d.attr("data-dragon-trash")))&&(!d.attr("data-dragon-accepts")||d.scope().$eval(d.attr("data-dragon-accepts"))(j))};d.length>0&&!e();)d=d.parent();var g=d.attr("data-dragon-sortable");if(void 0!==g&&"horizontal"!==g&&(c=S(d,a)),n&&(angular.element(n).remove(),n=null),d.length>0){{var h=angular.isDefined(d.attr("data-dragon"));angular.isDefined(d.attr("data-dragon-trash"))}if(h){var i=d.attr("data-dragon"),l=d.attr("data-dragon-on-drop"),o=d.scope(),q=i.match(b),r=o.$eval(q[2]),s=o.$eval(l);o.$apply(function(){L(r,j,k,c),s&&angular.isFunction(s)&&s(j,k)})}}else t||u||f.$apply(function(){L(m,j,k,c)});j=m=null,P()}}),{restrict:"A",compile:function(c,d){var l=d.dragon,x=l.match(b);if(!x)throw new Error('Expected dragon in form of "_item_ in _collection_ [as _alias_] [track by _track_] [| _filter_]" but got "'+l+'"."');var y=x[1],B=x[2];x=y.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);var D=x[3]||x[1],E=x[2];if(void 0!==c.attr("data-dragon-base")&&(c=M(c),!c))throw new Error("Expected data-dragon-base to be used with a companion data-dragon-conatiner");var F=c.html();try{if(F=angular.element(F.trim()),0===F.length)throw new Error("")}catch(G){F=angular.element("<span>"+F+"</span>")}var H=F.clone();H.attr("ng-repeat",l),void 0!==c.attr("data-dragon-sortable")&&H.attr("data-dragon-position","{{$index}}"),c.html(""),c.append(H);var I=void 0!==c.attr("data-dragon-duplicate"),J=void 0!==c.attr("data-dragon-eliminate"),L=c.attr("data-dragon-placeholder-template");return function(b,c,d){var l=b.$eval(d.dragonAccepts),x=angular.isDefined(L)?h.get(L):null;if(void 0!==l&&"function"!=typeof l)throw new Error("Expected dragonAccepts to be a function.");var y=function(){f.$broadcast("drag-start"),b.$apply(function(){p=F.clone(),p[0].style.cssText=i.getComputedStyle(F[0],null).cssText,p.css("position","fixed"),p.css("margin","0px"),p.css("z-index","99999");var c=b.$new();c[D]=j,E&&(c[E]=k),e(p)(c),w.append(p),a.bind("mousemove",A),N()})};c.bind("mousedown",function(b){if(!([1,2].indexOf(b.button)>-1)){var c=a[0].elementFromPoint(b.clientX,b.clientY).tagName;"SELECT"!==c&&"INPUT"!==c&&"BUTTON"!==c&&(v=!1,s=!!z(angular.element(b.target)),angular.isDefined(L)?angular.isDefined(x)?o=x:g({method:"GET",url:L,cache:!0}).then(function(a){o=x=a&&a.data}):o=null,b.preventDefault())}}),c.bind("mousemove",function(a){if(!(j||v||z(angular.element(a.target))||s)){for(var d=angular.element(a.target),e=d.scope();void 0===e[D];)if(e=e.$parent,!e)return;if(j=e[D],k=e[E],j){var f=Q(a.target);if(m=b.$eval(B),t=I,u=J,q=a.clientX-f.left,r=a.clientY-f.top,I)j=angular.copy(j);else{var g,h=c.children();if(o)for(var i=0;!g&&i<h.length;i++){var l=h[i];angular.element(l).scope()[E||D]===j&&i>0&&(g=h[i-1])}b.$apply(function(){K(m,k||m.indexOf(j)),o?(C(),angular.isUndefined(g)?c[0].insertBefore(n,c[0].firstChild):angular.element(g).after(n)):n=null})}y()}}})}}}}]),a=function(){function a(b,c){if("undefined"==typeof c&&(c=""),c.length>50)return"[MAX ITERATIONS]";var d=[];for(var e in b){var f=typeof b[e];d.push(c+'"'+e+'" ('+f+") => "+("object"==f?"object:"+a(b[e],c+"  "):b[e]+""))}return d.join(c+"\n")}var b=/%[sdj%]/g,c=function(c){if("string"!=typeof c){for(var d=[],e=0;e<arguments.length;e++)d.push(a(arguments[e]));return d.join(" ")}for(var e=1,f=arguments,g=f.length,h=String(c).replace(b,function(a){if(e>=g)return a;switch(a){case"%s":return String(f[e++]);case"%d":return Number(f[e++]);case"%j":return JSON.stringify(f[e++]);case"%%":return"%";default:return a}}),i=f[e];g>e;i=f[++e])h+=null===i||"object"!=typeof i?" "+i:" "+a(i);return h};return{format:c,inspect:a}}()}();
//# sourceMappingURL=dragon-drop.min.js.map